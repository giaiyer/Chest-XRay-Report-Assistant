# Chest X-Ray Report Assistant 

This application assists radiologists in generating detailed, professional chest X-ray (CXR) reports by combining computer vision (CV) and retrieval-augmented generation (RAG) with a local large language model (LLM).

---

## Features
- Upload chest X-ray images (PNG/JPG)
- Enter patient context (age, sex, symptoms, history)
- Automated visual findings using a real CV model (TorchXRayVision)
- Retrieval-augmented, structured report generation using a local Llama LLM
- Outputs professional, multi-section radiology reports (Findings, Impression, Next Steps, Conclusion, Relevant Negatives)

---

## How it Works
1. **Image Analysis (CV):**
   - Uses TorchXRayVision's DenseNet121 to detect common CXR findings.
2. **Context Input:**
   - User provides patient info and clinical context.
3. **Retrieval (RAG):**
   - The system retrieves a pre-defined report template (from `templates/cxr_templates.json`) based on the clinical scenario.
4. **Augmentation (RAG):**
   - The template is dynamically filled with the CV model's findings and patient context (age, sex, symptoms, history).
5. **Generation (RAG):**
   - The filled template is used as a prompt for the Llama LLM, which generates a professional, context-aware radiology report.

---

## Setup

1. **Install dependencies:**
   ```bash
   poetry install
   ```
2. **Download a Llama model:**
   - Download a GGUF-format Llama model (e.g., Llama-2-7B-Chat Q4_K_M) from Hugging Face (see TheBloke's models).
   - Place the model file in the `models/` directory.
   - By default, the app looks for `models/llama-2-7b-chat.Q4_K_M.gguf`. To use a different file, set the environment variable:
     ```bash
     export LLAMA_MODEL_PATH="models/your-model-file.gguf"
     ```

3. **Run the app:**
   ```bash
   poetry run streamlit run app.py
   ```
   Or, if running from the parent directory:
   ```bash
   poetry run streamlit run "medical rag/app.py"
   ```

---

## Usage
- Open the Streamlit web interface in your browser (usually at http://localhost:8501).
- Upload a CXR image and enter patient details.
- The app will display:
  - Automated findings from the CV model
  - A detailed, structured radiology report generated by the LLM

